machine:
  php:
    version: 7.1.3

dependencies:
  override:
    - composer install --no-interaction --no-ansi
  cache_directories:
    - "vendor"

test:
  override:
    - ./vendor/bin/phpunit --log-junit $CIRCLE_TEST_REPORTS/phpunit/junit.xml tests/

deployment:
  production:
    branch: master
    owner: macecchi
    commands:
      - ssh -A $CARONAE_PROD_USER@$CARONAE_PROD_HOST -p $CARONAE_PROD_PORT "cd ~/chave && git checkout . && git pull origin master && composer install --no-interaction --no-ansi --no-dev"

experimental:
  notify:
    branches:
      only:
        - master
